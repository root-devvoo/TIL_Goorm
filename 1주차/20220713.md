# 구름 쿠버네티스 과정 5기 3일차_20220713

## 네트워크

### OSI 7계층 / TCP 5계층

#### 네트워크 계층

| ![grouping-related-hosts](https://user-images.githubusercontent.com/78403443/178630295-f63eb993-6e2c-4c7f-8e02-a284ee43d4b9.png) |
| :----------------------------------------------------------: |
|                   *grouping related hosts*                   |

##### LAN

- 근거리 통신망
- 라우터 내부망을 의미

##### WAN

- 원거리 통신망
- 라우터 외부망을 의미

##### 확장성

| ![scalability-challenge](https://user-images.githubusercontent.com/78403443/178635057-56952769-e795-453d-b566-35b93f71278a.jpg) |
| :----------------------------------------------------------: |
|                   *scalability challenge*                    |

- IP 주소를 무작위로 배정하게 되면 라우터 안의 포워딩 테이블은 기하급수적으로 커지게 됨
  - 포워딩 속도가 느려짐
- 스케일이 커짐으로 인한 문제점

##### 서브넷 마스크 / prefix

- 같은 대역임을 알려주는 역할
- IP 주소를 용도에 따라 대역을 나눠줘야 할 필요성이 존재

192.168.56.10
192.168.56.11<BR>같은 대역으로 지정하고 싶다면 대표적으로<BR>**서브넷 마스크** : 255.255.255.0 으로 지정할 수 있음

|                          참고 자료                           |
| :----------------------------------------------------------: |
| ![image](https://user-images.githubusercontent.com/78403443/178659066-87f56ab9-bbe6-4958-94fb-d4a8111a63f1.png) |
| 출처 : <https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=hatesunny&logNo=220790654612> |

**프리픽스** : ip 주소 뒤에 /24로 표기할 수 있음

- 프리픽스의 숫자가 1 증가하면 ip 대역이 2분할됨

**게이트웨이** : 관문, 패킷이 나가고 들어오는 일종의 문 역할

| ![easy-to-add-new-hosts](https://user-images.githubusercontent.com/78403443/178657368-3687c6aa-6536-45a1-a380-c4fe98c284a2.jpg) |
| :----------------------------------------------------------: |
|                   *easy to add new hosts*                    |

서브넷 마스크 / prefix를 사용하여 ip를 질서있게 설정해놓으면 장점이 존재함

- 라우터들의 포워딩 테이블이 작아짐
  - 포워딩이 빨라짐
- ip 주소의 추가가 쉬움

##### 서브넷

- 같은 프리픽스를 가진 장치들의 집합

  | ![subnets](https://user-images.githubusercontent.com/78403443/178657993-0802899d-62db-4100-a58a-482882b6de4d.jpg) |
  | :----------------------------------------------------------: |
  |                          *subnets*                           |

  - 같은 서브넷에 있다는 표현을 사용

##### Network Address Translation(NAT)

- 계기 : IPv4 주소 부족

- IPv4 주소를 한 명만 사용하는 것이 아닌 하나의 주소를 여러 명이 공유하는 기술

  ![network-address-translation](https://user-images.githubusercontent.com/78403443/178659300-0a02241c-fca9-46fc-b9d5-8d277b02d81c.jpg)

  - 라우터들은 보통 공인 ip 주로 사용
  - 사용자들은 보통 사설 ip 주로 사용
    - 10.0.0.0 대역 / 192.168.0.0 대역

##### DHCP

- 자동으로 IP 주소를 배정해주는 프로토콜

###### DHCP 시나리오

| ![dhcp-client-server-scenario](https://user-images.githubusercontent.com/78403443/178661943-6f10fee1-2bce-4e7b-9055-15aba3d67125.jpg) |
| :----------------------------------------------------------: |
|                *DHCP client-server scenario*                 |

1. 클라이언트 측에서 ip 주소 할당을 위해 서버에 요청
   - 클라이언트는 ip가 없는 상태 : src 0.0.0.0
     - 포트 번호 : 68번
   - DHCP 서버를 찾아야 함 : dest 255.255.255.255
     - 포트 번호 : 67번
   - 할당받은 ip 주소가 없는 상태 : yiaddr 0.0.0.0
   - 클라이언트가 랜덤으로 선택한 ID : transaction ID 654
2. 서버 측에서 응답
   - 서버의 ip 주소 : src 223.1.2.5
     - 포트 번호 : 67번
   - 아직 클라이언트의 존재를 모름 : dest 255.255.255.255
     - 포트 번호 : 68번
   - 할당할 ip 주소를 지니고 있음 : yiaddr 223.1.2.4
   - 클라이언트가 랜덤으로 선택한 ID : transaction ID 654
   - 해당 ip를 사용할 수 있는 시간 : lifetime 3600 secs
3. 클라이언트 측에서 응답
   - 아직 ip 할당받지 못함 : src 0.0.0.0
     - 포트 번호 : 68번
   - 서버 측에 브로드캐스트로 통신 : dest 255.255.255.255
     - 포트 번호 : 67번
   - 클라이언트 측에서 자신이 할당받을 ip 주소를 인지함
     - yiaddr : 223.1.2.4
   - 다른 ID를 사용 : transaction ID 655
   - 해당 ip를 사용할 수 있는 시간도 인지함 : lifetime 3600
4. 서버 측에서 클라이언트 측으로 ip 할당해줌
   - 클라이언트는 앞으로 3600초동안 223.1.2.4 ip 주소 사용

> Q1 : 포트 번호가 67, 68로 다른데 어떻게 통신이 되는가?<br>R1 : 클라이언트는 68번을 이용하여 서버의 67번 포트와 통신을 함
>
> - 포트 번호가 같을 필요가 없음
>
> ---
>
> Q2 : 트랜잭션 ID를 바꾼 것은 단체톡방에서 개인톡방을 만든 느낌인가?<BR>R2 : 단체톡방과 개인톡방을 구분 짓지 말고, 다른 톡방을 만들었다고 생각하는 편이 좋음
>
> ---
>
> Q3 : DHCP 서버에서 본인의 IP주소를 클라이언트로 응답해주는데, 그 이후에도 클라이언트에서 DHCP서버로 통신을 할 때 브로드캐스트 형태로 통신을 주고받는 이유가 있을까?<BR>R3 : 정상적인 통신은 자신이 IP를 가지고 있어야 특정 IP와 통신이 가능
>
> - 클라이언트는 아직 IP를 부여받은 상태가 아니기 때문에 특정 IP와 통신할 수 없음
> - 클라이언트가 IP가 없어도 브로드캐스트는 가능함
>
> ---
>
> Q4 : NAT으로 사설 IP를 사용할 수 있는데 굳이 DHCP로 IP를 할당받는 이유가 뭔가?<BR>R4 : DHCP로 IP 할당받는 이유 : 빠르게 IP를 부여받아서 통신하기 위해
>
> - 서버는 움직이면 안되기 때문에 고정 IP를 사용
>
> ---
>
> Q5 : 서버를 위한 IP 부여: NAT<BR>클라이언트를 위한 IP부여: DHCP...?<BR>R5 : NAT는 IP를 부여할 때 쪼개서 사용하겠다라는 기술<br>DHCP는 NAT에 의해서 쪼개진 IP를 자동으로 할당해주는 기술<BR>DHCP 서버는 IP들을 가지고 있는 서버

##### ICMP(Internet Control Message Protocol)

- 네트워크 상에서 통신이 가능한지 확인할 때 사용하는 프로토콜
- ping 명령어 사용
  - 통신이 잘 되는지 확인해줌
  - ex) 구글과 통신이 잘 되는지 확인하기 위해서 cmd 창 or MAC 터미널에서 명령어 입력 : `ping 203.130.111.154`

> 구글에 대한 ip 주소를 찾아주세요 라는 명령어 (전에 다뤘던 명령어임)
>
> ```
> nslookup www.google.com
> ```
>
> 통신이 잘 되고 있는지 확인하는 명령어<br>(8.8.8.8 : 구글 DNS 서버 IP주소)
>
> ```
> ping 8.8.8.8
> ```

##### 라우터

- 중간 통신 역할 수행

##### 라우팅 알고리즘

- 라우터에 들어간 기능
- 포워딩 테이블을 만들 때 사용

> ※ 참고
>
> 경로 설정 방법 (수동 vs 동적) 
>
> - Static
>   - 정적 라우팅
>   - 관리자가 수동으로 경로를 입력
>     - 소규모 망에서 주로 사용
> - Dynamic
>   - 동적 라우팅
>   - 라우터가 결정하는 방식

###### 라우팅 알고리즘 종류

- **링크 상태 알고리즘**

  - 중간 라우터가 자신이 가지고 있는 링크 정보를 브로드캐스트로 전체에게 알려줌

  - 라우터들이 경로들을 인지

    | ![dijsktra-algorithm](https://user-images.githubusercontent.com/78403443/178673729-67e48023-1962-4f21-99e4-f2bec15c7d42.png) |
    | :----------------------------------------------------------: |
    |          *다익스트라 알고리즘 (dijsktra algorithm)*          |
    | ![다익스트라 알고리즘2](https://user-images.githubusercontent.com/78403443/178673962-fd1523be-ce0c-4b2f-ac48-b0a6606878f6.png) |

    - 효율적인 경로를 정하는 건 다른 문제

  - 거리 비용 계산 값을 포워딩 테이블에 채워놓음

  - **다익스트라 알고리즘을 사용**

- **거리 벡터 알고리즘**
  - 이웃과 정보를 교환하는 방식
    - 이웃과의 이동 비용을 알 수 있음

AS - 자치 시스템

| ![hierarchical-routing](https://user-images.githubusercontent.com/78403443/178675788-ee0a436a-8959-4d0a-a36f-bce4c997996b.jpg) |
| :----------------------------------------------------------: |
| *hierarchical routing*<br>(실제 네트워크 망은 이런식으로 되어있다.) |

- 네트워크 영역
  - LG U+ SK, KT
- AS 내부에서는 Link state / Distance Vector 알고리즘을 사용하여 라우팅을 실시함

###### 알고리즘 별 프로토콜

Link state 알고리즘 - OSPF 프로토콜<BR>Distance Vector 알고리즘 - RIP 프로토콜

####  계층 정리 🖐️

애플리케이션 계층 - 메시지 전송만을 다룸<BR>트랜스포트 계층 - 신뢰성과 관련<BR>네트워크 계층 - 패킷을 전송하는 경로 관련

#### 데이터 링크 계층

- 전송한 패킷이 어떻게 다음 게이트웨이까지 갈 것인지를 다룸
- 여러명의 사용자가 하나의 게이트웨이로 패킷을 보낼 수 있음
  - 패킷끼리 충돌 발생 가능성 존재
- 데이터 링크 계층에서의 가장 중요한 역할은 충돌 방지 / 충돌 발생 시 문제를 해결하는 역할

> 트랜스포트 계층이나 네트워크 계층은 OS 내부에 소프트웨어로 구현
>
> 데이터링크 계층은 하드웨어 안에 구현

##### 데이터 링크 계층에서의 전송 방식

- point-to-point

  - 전용선으로 연결되어서 아무런 충돌없이 사용하는 방식

- broadcast

  - 실제로 전체 구성원에게 전달을 하는 역할

    > 채널 전체한테 뿌려주는 역할을 함

  - MAC 프로토콜을 사용하여 원하는 곳으로 안전하게 보냄

    > (MAC 프로토콜은) 충돌을 방지하기 위해 순서를 제어하는데 사용함

    - Media Access Control의 약자

      > (MAC 주소와는 다르다. 애플社의 MAC도 아님.)

##### ARP(Address Resolution Protocol)

- 데이터를 보낼 때 ip 주소만 사용하지 않음
- MAC address를 같이 매칭하여 데이터를 전송

##### MAC address

- 물리적 주소

  ```
  cmd에 ipconfig /all 명령어 입력 후
  물리적 주소란을 확인하면 됨 
  <하이픈(-) 기준으로 좌측에서 3번째까지 제조사 ID>
  ```

- 랜카드에 고유 번호를 부여

브라우저에 세션 남는 느낌으로 이해해도 됨(비영구)

한 번 보낸 MAC 주소는 일정 시간 기억하고 있음(switch)

라우터와 스위치의 차이점?<br>라우터는 경로 설정 / 전송<br>스위치는 경로 설정 X

#### 물리 계층

- 전기적 신호로 데이터를 전송
